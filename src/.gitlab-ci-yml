include:
  - project: "dep/library/ci-library"
    ref: production
    file: "main.yml"

variables:
  SONAR_URL: https://sonarcloud.io
  OPENSHIFT_URL: https://master.innershift.sodigital.io
  OPENSHIFT_APP_URL: apps.innershift.sodigital.io
  OPENSHIFT_PROJECT: ${CI_PROJECT_NAME}

build-application:
  stage: build-application
  except:
    - production
  image:
    name: trion/ng-cli
  before_script:
   - npm install
  script:
    - ng serve
  artifacts:
  expire_in: 1 day
    paths:
  - dist/
   tags:
  - docker
  cache:
    key: "$CI_COMMIT_REF_SLUG"
    paths:

  variables:
  CLI_VERSION: 6.2.1

test:karma:
  stage: test
  image: trion/ng-cli-karma:${CLI_VERSION}
  allow_failure: false
  script:
  - ng test --progress false --watch false
  tags:
  - docker